# 一、进程的 概念、组成、特征

```
1. 进程
	概念
		进程是进程实体的运行过程,是系统进行资源分配和调度的一个独立单位

	组成
		PCB
			进程描述信息
			进程控制和管理信息
			资源分配清单
			处理机相关信息
		程序段
			程序的代码(指令序列)
		数据段
			运行过程中产生的各种数据(如:程序中定义的变量)
	特征
		动态性
			进程的最基本特性
		并发性
		独立性
			进程是能独立运行、独立获得资源、独立接受调度的基本单位
		异步性
			各进程以不可预知的速度向前推进,可能导致运行结果的不确定性
		结构性
```

# 二、进程的状态与转换

> 状态 转换 进程的组织方式

## 状态

- 三种基本状态
  1. 运行态: 进程在CPU上运行
     - 单核CPU同一时刻只会有一个进程处于运行态
  2. 就绪态: 进程可以运行,但没有空闲的CPU
  3. 阻塞态: 又称(等待态) 因等待某一事件而暂时不能运行
- 另外两种
  1. 创建态: (新建态) 进程正在被创建, 操作系统分配资源、初始化PCB
  2. 终止态: (结束态) exit系统调用,请求操作系统终止该进程, 回收资源,撤销pcb
- 操作系统是如何记住进程的状态的
  - 进程PCB中,有一个变量 state 来表示进程当前的状态 

## 状态的转换

- 进程状态的转换

  ![image-20230904234732467](https://wxytypora.oss-cn-beijing.aliyuncs.com/img/image-20230904234732467-16938424598691-16938424649523.png)

## 进程的组织

- 链接方式
  - 执行指针 -> PCB2 
    - 指向当前处于运行态的进程
  - 就绪队列指针 -> PCB5 -> PCB1 -> PCB4
    - 通常把优先级高的放在队头
  - 阻塞队列
    - 会根据阻塞原因不同分为多个阻塞队列
      - 等待打印机的阻塞队列 -> PCB3 -> PCB7
      - 等待磁盘的阻塞队列 -> PCB6
- 索引方式
  - 通过索引表指向进程, 了解即可,因为大部分都是链接方式

# 三、进程控制

>  概念 进程控制的相关原语

## 概念

1. what is 进程控制

   - 进程控制的主要功能是对系统中的所有进程实施有效的管理,它具有创建新进程、撤销已有进程、实现进程状态转换等功能

   - 简化理解:反正进程控制就是要实现进程状态转换 

2. 如何实现进程控制   用原语实现

   - 原语: 原语是一种特殊的程序,它的执行具有原子性也就是说,这段程序的运行必须一气呵成,不可中断 

     - 为什么进程控制(状态的转换) 要一气呵成?

       ```shell
       eg: 一个进程 阻塞态 -> 就绪态
       就绪队列指针 -> PCB5 state=1 -> PCB1 state=1 
       阻塞队列指针 -> PCB2 state=1 -> PCB3 state=2
       	
       	操作系统要进行如下操作:
       		1. 将PCB2的state设为1
       		2. 将PCB2从阻塞队列放到就绪队列
       	如果完成了第一步后收到中断信号,那么PCB2的state=1,但是它却被放在阻塞队列里
       	如果不能“一气呵成”,就有可能导致操作系统中的某些关键数据结构信息不统一的情况,这会影响操作系统进行别的管理工作
       ```

   - 如何实现原语的原子性

     > 用 关中断指令 和开中断指令 这两个特权指令实现原子性

     - 正常执行的指令

       ```sehll
       正常情况:
       	CPU每执行完一条指令都会例行检查是否有中断信号需要处理,如果有,
       	则暂停运行当前这段程序,转而执行相应的中断处理程序。
       ```

       ![image-20230905005947265](https://wxytypora.oss-cn-beijing.aliyuncs.com/img/image-20230905005947265.png)

     - 执行了关中断指令

       ```shell
       CPU执行了关中断指令之后,就不再例行检查中断信号,直到执行开中断指令之后才会恢复检查。
       
       这样,关中断、开中断之间的这些指令序列就是不可被中断的,这就实现了“原子性”
       ```

       ![image-20230905010115368](https://wxytypora.oss-cn-beijing.aliyuncs.com/img/image-20230905010115368.png)

	## 进程控制相关的原语

- 无论哪个进程控制原语,要做的无非三类事情

  1. 更新PCB中的信息
     1. 修改进程状态state 
     2. 保存/恢复运行环境

  1. 将PCB插入合适的队列

  1. 分配/回收资源

```
进程控制相关的原语 (理解即可)
	1_进程的创建
		创建原语
			申请空白PCB
			为新进程分配所需资源
			初始化PCB
			将PCB插入就绪队列
		引起进程创建的事件
			用户登录
				分时系统中,用户登录成功,系统会建立为其建立一个新的进程
			作业调度
				多道批处理系统中,有新的作业放入内存时,会为其建立一个新的进程
			提供服务
				用户向操作系统提出某些请求时,会新建一个进程处理该请求
			应用请求
				由用户进程主动请求创建一个子进程
	2_进程的终止
		撤销原语
			从PCB集合中找到终止进程的PCB
			若进程正在运行,立即剥夺CPU,将CPU分配给其他进程
			终止其所有子进程
				进程之间的关系是树形结构
			将该进程拥有的所有资源归还给父进程或操作系统
			删除PCB
		引起进程终止的事件
			正常结束
				进程自己请求终止 exit系统调用
			异常结束
				整数除0、非法使用特权指令被操作系统强行杀掉
			外界干预
				CTRL+Alt+delete, 用户手动杀掉进程
	进程的阻塞和唤醒
		3_进程的阻塞
			阻塞原语
				找到要阻塞的进程对应的PCB
				保护进程运行现场,将PCB状态信息设置为“阻塞态",暂时停止进程运行
				将PCB插入相应事件的等待队列
			引起进程阻塞的事件
				需要等待系统分配某种资源
				需要等待相互合作的其他进程完成工作
		4_进程的唤醒
			唤醒原语
				在事件等待队列中找到PCB
				将PCB从等待队列移除,设置进程为就绪态
				将PCB插入就绪队列,等待被调度
			引起进程唤醒的事件
				等待的事件发生
	5_进程的切换
		切换原语
			将*运行环境*信息存入PCB
			PCB移入相应队列
			选择另一个进程执行,并更新其PCB
			根据PCB恢复新进程所需的运行环境
		引起进程切换的事件
			当前进程时间片到
			有更高优先级的进程到达
			当前进程主动阻塞
			当前进程终止
```



## 程序是如何运行的

![image-20230905013606755](D:/mynote/2_%E4%B8%93%E4%B8%9A/02_2%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2_%E8%BF%9B%E7%A8%8B%E7%AE%A1%E7%90%86/assets/image-20230905013606755.png)

- 寄存器

  - PSW; PC; IR; 通用寄存器

  
