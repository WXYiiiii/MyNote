## 一、操作系统的概念
- 操作系统（Operating System， OS）
   > 系统资源的管理者, 向上层提供方便的服务, 最接近硬件的一层软件
   - 是指控制和管理整个计算机系统的硬件和软件资源，并合理地组织调度计算机的工作和资源的分配 
   - 以提供给用户和其他软件方便的接口和环境
   - 它是计算机系统中最基本的系统软件
### 1、系统资源的管理者
- 处理机管理
- 存储器管理
- 文件管理
- 设备管理
  
  ![img.png](assets/img.png)
### 2、 向上层提供服务 
> 封装: 操作系统把一些丑陋的硬件功能封装成简单易用的服务，使用户能更方便地使用计算机，用户无需关心底层硬件的原理，只需要对操作系统发出命令即可

> 用户直接使用: GUI、命令接口
> 程序员/软件使用: 程序接口
1. GUI图形化用户接口
2. 命令接口
   1. 联机命令接口   交互式命令接口 如:win+r cmd
   2. 脱机命令接口   批处理命令接口 如: .bat文件
3. **程序接口:**
   可以在程序中进行*系统调用*来使用程序接口。普通用户不能直接使用程序接口，只能通过程
序代码*间接*使用
   - **系统调用:** 类似于函数调用，是应用程 序请求操作系统服务的唯一方式.
     > 系统调用 = 广义指令
### 3、最接近硬件的软件
- 需要实现对硬件机器的扩展

## 二、操作系统的基本特征
- 并发、共享、虚拟、异步  
- 最基本: 并发、共享 没有并发和共享就谈不上虚拟和异步
1. 并发
    > 并发: 宏观上同时,微观上交替
    > 
    > 并行: 同时执行
   - 指两个或多个事件在同一时间间隔内发生。这些事件宏观上是同时发生的，但微观上是交替发生的
   - 操作系统伴随多道程序技术而出现, 因此,操作系统和并发是一起诞生的
   - 单核CPU: 同一时刻只能执行一个程序,各个程序只能并发的执行
   - 多核CPU: 可以并行,4核可以并行4个程序
2. 共享
    - 共享即资源共享，是指系统中的资源可供内存中多个并发执行的进程共同使用
   1. 互斥共享方式
      - 一个时间段内只允许一个进程访问该资源   
      - 如: 摄像头、打印机
   2. 同时共享方式
       - 一个时间段内允许多个进程'同时'对它们进行访问
         - 如: 硬盘 微观上是交替的
         - 如: 扬声器 微观上也是同时
   3. **并发和共享的关系**
       1. 两者互为存在条件
          - 没有共享性就无法实现并发
          - 没有并发性就用不到共享
3. 虚拟
    >虚拟是指把一个物理上的实体变为若干个逻辑上的对应物。物理实体（前者）是实际存在的，而逻辑上 对应物（后者）是用户感受到的
   1. 空分复用技术
      - 将物理上的实体变为逻辑上的对应物 
      - 如: 虚拟存储
   2. 时分复用技术
      - 如: 虚拟处理器
   3. 关系
      - 没有并发行就没有虚拟性
4. 异步
    - 异步是指，在多道程序环境下，允许多个程序并发执行，但由于资源有限，进程的执行不是一贯到底的， 而是走走停停，以不可预知的速度向前推进，这就是进程的异步性
    - 关系
       - 有并发性,才有可能导致异步

## 三、操作系统的分类
1. 手工操作阶段
   - 缺点: 
     - 用户独占全机,人机速度矛盾,资源利用率低
2. 批处理阶段
   1. 单道批处理系统
      - 缺点: 
        - 内存中仅能有一道程序运行
        - CPU有大量时间在空闲等待IO完成,资源利用率依旧很低
   2. 多道批处理系统
      > 操作系统正式诞生
      - 优点:
        - 多道程序并发执行
        - 资源利用率大幅提升
      - 缺点
        - 用户响应时间长
        - 没有人机交互功能
          - 无法调试程序
          - 无法在程序运行过程中输入参数
3. 分时操作系统
   > 计算机以时间片为单位轮流为各个用户/作业服务，各个用户可通过终端与计算机进行交互。
    - 优点：
      - 解决了人机交互问题
      - 允许多个用户同时使用一台计算机，并且用户对计算机的操作相互独立，感受不到别人的存在。
    - 缺点:
      - 不能优先处理一些紧急的任务
      - 操作系统对各个用户/作业都是完全公平的，循环地为每个用户/作业服务一个时间片，不区分任务的紧急性
4. 实时操作系统
   - 优点: 
     - 优先响应一些紧急任务,某些紧急任务不需要时间片排队
   - 特点:
     - 及时性,可靠性
     - 要在严格的时限内完成处理
   1. 硬实时操作系统
      - 严格的时间规定
      - 如: 导弹、自动驾驶
   2. 软实时系统
      - 偶尔接受违反时间规定
5. 其他
   1. 网络操作系统
   2. 分布式操作系统
      - 分布,并行
   3. 个人计算机操作系统 
      - win macos

## 四、操作系统运行机制
### 1、预备知识
1. 程序的运行原理
   1. 程序运行过程就是CPU执行指令的过程
   2. 高级语言代码 -> 机器指令(二进制)
   - 指令: 处理器能识别,执行的最基本的命令
     - linux、win cmd的'小黑框'中的命令是 交互式命令接口
     - 这里的指令是指二进制机器指令
2. 内核程序&应用程序
   1. 应用程序: 普通程序员写的
   2. 内核程序: 实现操作系统的程序
   - 内核: 
     - 很多内核程序组成了内核
     - 操作系统最核心的部分.也是最接近硬件的部分
     - 操作系统只需要有内核就够了, 操作系统的功能未必都在内核中，如图形化用户界面 GUI
3. 特权指令&非特权指令
   1. 特权指令
      - 只允许内核程序执行
      - 如：内存清零指令
   2. 非特权指令
      - 应用程序只能使用“非特权指令”
      - 如：加法指令、减法指令等
   - CPU设计和生产的时候就划分了特权指令和非特权指令，因此CPU执行一条指令前就能判断出其类型
4. 内核态&用户态
   - CPU 有两种状态，“内核态”和“用户态”
   - 别名：内核态=核心态=管态；用户态=目态
   1. 处于内核态时，说明此时正在运行的是内核程序，此时可以执行特权指令
   2. 处于用户态时，说明此时正在运行的是应用程序，此时只能执行非特权指令
5. 如何变态
   - 程序状态寄存器:
     - CPU 中有一个寄存器叫 程序状态字寄存器（PSW），其中有个二进制位，1表示 “内核态”，0表示“用户态”
   - 切换例子
       ```shell
       一个故事：
       ① 刚开机时，CPU 为“内核态”，操作系统内核程序先上CPU运行
       ② 开机完成后，用户可以启动某个应用程序
       ③ 操作系统内核程序在合适的时候主动让出 CPU，让该应用程序上CPU运行
           操作系统内核在让CPU之前，会用一条权指令把 PSW 的标志设置为“用户态”
       ④ 应用程序运行在“用户态”
       ⑤ 此时，一位猥琐黑客在应用程序中植入了一条特权指令，企图破坏系统…
       ⑥ CPU发现接下来要执行的这条指令是特权指令，但是自己又处于“用户态”
       ⑦ 这个非法事件会引发一个中断信号
         CPU检测到中断信号后，会立即变为“核心态”，并停止运行当前的应用程序，转而运行处理中断信号的内核程序
       ⑧ “中断”使操作系统再次夺回CPU的控制权
       ⑨ 操作系统会对引发中断的事件进行处理，处理完了再把CPU使用权交给别的应用程序
       ```
   1. 内核态à用户态：
      - 执行一条特权指令——修改PSW的标志位为“用户态”，这个动作意味着操作系统将主动让出CPU使用权
   2. 用户态à内核态：
      - 由“中断”引发，硬件**自动**完成变态过程，触发中断信号意味着操作系统将**强行**夺回CPU的使用权
### 2、中断和异常
      test11
111